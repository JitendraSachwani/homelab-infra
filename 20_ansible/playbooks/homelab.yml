---
# ============================================================
# Homelab Master Playbook
#
# This playbook is safe to run repeatedly.
# It configures all infrastructure created by Terraform.
# ============================================================

# ------------------------------------------------------------
# IaC Controller (LOCALHOST)
# ------------------------------------------------------------
- name: Configure IaC Controller
  hosts: localhost
  become: true

  roles:
    - common
    - iac_controller

# ------------------------------------------------------------
# Core Stack
# ------------------------------------------------------------
- name: Configure CI Runners
  hosts: ci_runner
  become: true
  roles:
    - common
    - docker
    - ci_runner

- name: Configure Networking Services
  hosts: networking
  become: true
  roles:
    - common
    - networking

- name: Configure Core Apps
  hosts: core_stack
  become: true
  roles:
    - common
    - docker
    - core_stack

# ------------------------------------------------------------
# Databases
# ------------------------------------------------------------
- name: Configure Redis
  hosts: db_redis
  become: true
  roles:
    - db_redis

- name: Configure MySQL
  hosts: db_mysql
  become: true
  roles:
    - db_mysql

- name: Configure PostgreSQL
  hosts: db_postgres
  become: true
  roles:
    - db_postgres

- name: Configure MongoDB
  hosts: db_mongo
  become: true
  roles:
    - db_mongo

# # ------------------------------------------------------------
# # Monitoring Stack
# # ------------------------------------------------------------
# - name: Configure Monitoring Nodes
#   hosts: monitoring
#   become: true
#   roles:
#     - common
#     - monitoring

# # ------------------------------------------------------------
# # Docs / Wikis
# # ------------------------------------------------------------
# - name: Configure Documentation Nodes
#   hosts: docs
#   become: true
#   roles:
#     - common
#     - docs


# ------------------------------------------------------------
# Media Stack
# ------------------------------------------------------------

- name: Configure Media Servers
  hosts: media_srv
  become: true
  roles:
    - common
    - media_srv

- name: Configure Media Management
  hosts: media_mgmt
  become: true
  roles:
    - common
    - media_mgmt

# ------------------------------------------------------------
# Market Diaries Rendering Cluster
# ------------------------------------------------------------
- name: Configure Market Diaries Storage Node
  hosts: market_diaries_storage
  become: true
  roles:
    - common
    - docker
    - market_diaries_storage

- name: Configure Market Diaries Renderer Nodes
  hosts: market_diaries_renderer
  become: true
  roles:
    - common
    - docker
    - market_diaries_renderer
