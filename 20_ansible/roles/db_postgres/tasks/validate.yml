- name: Wait for PostgreSQL to be reachable
  ansible.builtin.wait_for:
    host: "{{ ansible_host }}"
    port: 5432
    timeout: 30

- name: Verify PostgreSQL responds
  ansible.builtin.command: >
    sudo -u postgres psql -d postgres -c "SELECT 1;"
  register: pg_test
  failed_when: pg_test.rc != 0
  changed_when: false
