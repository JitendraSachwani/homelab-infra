- name: Create media mount point
  ansible.builtin.file:
    path: /mnt/media
    state: directory
    mode: "0755"

# - name: Mount NAS media share
#   ansible.builtin.mount:
#     src: "{{ nas_ip }}:{{ nas_media_export }}"
#     path: /mnt/media
#     fstype: nfs
#     opts: rw,_netdev,noatime
#     state: mounted

- name: Create Tdarr server systemd service
  ansible.builtin.copy:
    dest: /etc/systemd/system/tdarr-server.service
    mode: "0644"
    content: |
      [Unit]
      Description=Tdarr Server
      After=network.target

      [Service]
      Type=simple
      User=root
      WorkingDirectory={{ tdarr_install_dir }}
      ExecStart={{ tdarr_install_dir }}/Tdarr_Server
      Restart=always

      [Install]
      WantedBy=multi-user.target
  notify: Reload systemd
