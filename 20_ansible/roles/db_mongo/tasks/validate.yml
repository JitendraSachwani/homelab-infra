- name: Wait for MongoDB to be reachable
  ansible.builtin.wait_for:
    host: "{{ ansible_host }}"
    port: 27017
    timeout: 30

- name: Verify MongoDB responds
  ansible.builtin.command: mongosh --eval "db.runCommand({ ping: 1 })"
  register: mongo_ping
  failed_when: "'ok' not in mongo_ping.stdout"
  changed_when: false
